# MUD + HappyChain Client Template

This templates sets up your frontend to work with MUD and the Happy Wallet on HappyChain.

Beyond Happy Wallet integration, this template improves the boilerplate from the [official MUD
templates][mud-templates] to set up nice abstractions.

[mud-templates]: https://github.com/latticexyz/mud/tree/main/templates

# TODO

1. Test!!
1. Better way to specify components and system calls than editing them in the `mud` package.
1. Make the HappyWallet display nicely. 
1. Update packages, and adopt upstream changes (few of those).
1. Add some basic gameplay for demo purpose — maybe port Emojimon to Phaser.
   - And explain how to make the repo "fresh" by removing this.
1. Improve & add documentation.

## How To ...

### Generate Tilesets

See README in the `art` package.

### Add new MUD system calls

After implementing them on the contract side, you can add corresponding actions in
`src/mud/createSystemCalls.ts`.

TODO: improve this

### Add new MUD components

Edit `mud.config.ts` in the `contracts` package and run `pnpm build`. Nothing to be done on the
client side!

If you want to make components overridable locally, you can edit them in `src/mud/createMud.ts`, e.g.

```typescript
components = {
   ...components,
      Player: overridableComponent(components.Player),
      Position: overridableComponent(components.Position),
   }
```

TODO: improve this

### Query the table for components

TODO

### Change the Phaser configuration

Edit `phaserConfig.ts`, `createCamera.ts` and `createMapSystem.ts` in `src/phaser-config`.

## Directory Layout & Key Exports
```
packages/client/
├── dist/                        production build outputs (`pnpm build`)
├── public/assets/               autogenerated tilesets from the `art` package
├── src/
│   ├── artTypes/                autogenerated types from the `art` package
│   ├── mud/                     MUD setup
│   │   ├── `createMUD()`           (create MUD client — called by `MUDProvider`)
│   ├── mud-react/               React scaffolding for MUD
│   │   ├── `<MUDProvider>`         (React provider — setup)
│   │   ├── `useMUD()`              (React hook — client access)
│   ├── mud-configs/             preset builders for `MUDClientConfig`
│   │   ├── `createHappyConfig()`   (for Happy Wallet)
│   │   ├── `createBurnerConfig()`  (burner wallet for other chains)
│   ├── phaser-react/            utilities to setup and use Phaser from React
│   │   ├── `<PhaserContainer>`     (React component to render Phaser)
│   │   ├── `usePhaser()`           (React hook — scene access)
│   ├── phaser-config/           Phaser configuration & setup (loaded by `PhaserContainer`)
│   │   ├── `phaserConfig`          (config)
│   │   ├── `createCamera`          (setup camera)
│   │   ├── `createMapSystem`       (setup map)
│   ├── ui/                      React components for scaffolding and loading
│   ├── utils/                   generic utilities
```

As a user of this template, you will mostly need to interact with `useMUD` and `usePhaser`, as well
as edit various files (see "How To..."  above).

## MUD Boilerplate

You don't necessarily need to understand how this works to start building.

1. `MUDProvider` calls `createMUD` with a `MUDClientConfig`
    - The `MUDConfig` defines where to find the World contract for this app and how to interact with it.
2. `createMUD` creates the MUD client (type `MUD`) by connecting to the World contract and
    initiating the synchronization the client with it. It returns once synchronization is initiated.
    - During the initial MUD load (pre-sync), `MUDProvider` displays its `fallback` component.
    - If an error occurs during the initial MUD load, `MUDProvider` displays its `errorFallback` component.
3. Once available, `MUDProvider` is stored in a Zustand store (`mud-react/store.ts`).
4. Your code can access the MUD client with the `useMUD()` hook.
5. After initial load, the sync progress can be accessed with
   `const { components: { SyncProgress } } = useMUD();`.
    - This is done by the `<LoadingScreen>` component inside `<App>`, which displays sync progress
      over the entire window while MUD is syncing.
6. Meanwhile, the `<PhaserContainer>` component inside `<App>` initializes Phaser, and sets up a
   full-window element for Phaser to render it, which becomes visible after the loading screen disappears.

## Using MUD, Phaser & HappyChain without React

TODO